---
 title: 聚焦爬虫 
 tags: [python,爬虫]
---

### 1. 正则表达式

### 2. bs4解析

![image-20201212132018924](https://forpinco.oss-cn-chengdu.aliyuncs.com/20201212132019.png)

#### 2.1 定位标签

- soup.tagName	返回文档中第一次出现的名为tagName的标签

- soup.find(‘tagName’)  

  - 和soup.tagName作用一致
  - 属性定位:  soup.find(‘tagName’,class_/id/attr=‘类’)  class加下划线是因为class是一个关键字
  - soup.find_all(...) 找到符合标准的所有的标签

- soup.select()  和css一样,中间参数为选择器

  - soup.select(‘.class’)  可以是类选择器,id选择器,标签选择器,返回的是一个列表

  - 层级选择 soup.select(‘ .tang > ul > li > a’) [0] 查找清明时节的那一个标签, > 表示的是层级关系(一个层级), 如果表示中间间隔多个层级,可以用空格,例如:

    soup.select(‘.tang > ul a’)[0] 这样表示的是class属性为tang的标签下面的子标签ul下面的所有a标签(可以间隔多级,只要被ul包裹就行)的第一个a标签,也就是清明时节...

#### 2.2 获取信息:

##### 2.2.1 获取标签之间的文本数据

soup.xxx.text   / .string / .get_text()

```python
例如:
     soup.select(‘ .tang > ul > li > a’).text 返回的数据就是清明时节.....
     soup.select(‘ .tang > ul > li > a’).string
     soup.select(‘ .tang > ul > li > a’).get_text()
差别:
    text / get_text()可以获得标签之间的所有文本内容,即时这个这个内容不是它所直属的.例如:
        <div>
        	<a>我是a标签的直系内容</a>
            我是div直系的文本内容
        </div>
        此方法可以获取所有子标签(这里是a标签)中的文本内容以及他的直系内容
    string 只能获取该标签下的直系文本内容,这里就是只能获取到我是div直系的文本内容
```

##### 2. 获取标签的属性值:

soup.a[‘href’] 也就是和获取字典内容一样的方法 拿到a标签的href属性

<img src="https://forpinco.oss-cn-chengdu.aliyuncs.com/20201212133033.png" alt="image-20201212133033675" style="zoom:67%;" />

### 3. Xpath

![image-20201212142207709](https://forpinco.oss-cn-chengdu.aliyuncs.com/20201212142207.png)

#### 3.1 定位:

##### 3.1.1 层级定位

按照标签的层级属性进行定位

```python
from lxml import etree
# 将test.html转化为一个tree对象
tree = etree.parse('./test.html')
# 查找title标签 (目标上面的html图片内容)
tree.xpath('/html/head/title')  # / 代表根节点或者一层的意思,后一种意思和bs4里面的>作用相同
# 返回的是一个已经封装好的element对象list集合 
```

##### 3.1.2 属性定位

按照标签的某些属性(class,id 等等进行定位)

```python
from lxml import etree
# 将test.html转化为一个tree对象
tree = etree.parse('./test.html')
# 查找苏轼所在的p标签
tree.xpath('//div[@class="song"]')  # // 代表多层, 如果是直接//div,表示查找任意位置的div标签
# 返回的是一个已经封装好的element对象list集合
```

##### 3.1.3 索引定位

按照层级和属性进行定位后,想查找这个标签下面固定位数的标签

```python
from lxml import etree
# 将test.html转化为一个tree对象
tree = etree.parse('./test.html')
# 查找class="song"的div
tree.xpath('//div[@class="song"]/p[3]')  # // 代表多层, 如果是直接//div,表示查找任意位置的div标签,p[3]表示查询到的第三个p标签,注意是从1开始的
# 返回的是一个已经封装好的element对象list集合
```

##### 3.2.4 相对路径解析

先解析到li,然后再由li对象开始解析,  ./表示从当前对象开始

##### 3.2.5 与 / 或  聚合多种条件

```python
from lxml import etree
# 将test.html转化为一个tree对象
tree = etree.parse('./test.html')
# 查找class="song"的div
tree.xpath('//div[@class="song"]/p[3] | //div/p')  表示无论符合前面的还是后面的,都可以 
```



![image-20201212153311164](https://forpinco.oss-cn-chengdu.aliyuncs.com/20201212153311.png)

#### 3.2 取值

##### 3.2.1 取标签之间的值

```python
# 取苏轼这个词
from lxml import etree
# 将test.html转化为一个tree对象
tree = etree.parse('./test.html')
# 查找class="song"的div
tree.xpath('//div[@class="song"]/p[3]/text()')  # // 代表多层, 如果是直接//div,表示查找任意位置的div标签,p[3]表示查询到的第三个p标签,注意是从1开始的
放回的是一个字符串列表,
注意: 
    1. /text()表示取p[3]的直系标签内的值,不包括其子标签的标签间的值
    2. //text()表示取得这个标签下面所有的标签间的值,包括子标签的标签间
```

##### 3.2.2 取标签属性值

```python
# img标签的src属性
from lxml import etree
# 将test.html转化为一个tree对象
tree = etree.parse('./test.html')
# 查找class="song"的div
tree.xpath('//img/@src')  # // 代表多层, 如果是直接//div,表示查找任意位置的div标签,p[3]表示查询到的第三个p标签,注意是从1开始的
放回的是一个字符串列表,
注意: 
    1. /@src表示取这个标签的这个属性值
```

